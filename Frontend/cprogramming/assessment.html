<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>C Programming Assessment</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        h1, h2 {
            text-align: center;
        }
        .card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 20px auto;
            padding: 20px;
            max-width: 800px;
        }
        .question {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
        }
        textarea {
            width: 100%;
            height: 160px;
            background: #f1f1f1;
            font-family: monospace;
            border: none;
            resize: none;
            margin-bottom: 15px;
        }
        .btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin: 8px 4px;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .btn-secondary {
            background-color: #6c757d;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        .btn-success {
            background-color: #28a745;
        }
        .btn-success:hover {
            background-color: #1e7e34;
        }
        .timer {
            font-size: 18px;
            color: #dc3545;
            text-align: center;
        }
        input[type="text"] {
            padding: 10px;
            font-size: 16px;
            width: 60%;
            border: 1px solid #ccc;
            border-radius: 6px;
            margin: 10px auto;
            display: block;
        }
    </style>
</head>
<body>

    <h1>C Programming Assessment</h1>
    <p id="attemptMsg" style="text-align:center;"></p>

    <div id="quiz-container" class="card"></div>
    <div class="timer" id="timer"></div>

    <div style="text-align:center;">
        <button class="btn btn-secondary" onclick="previousQuestion()">Previous</button>
        <button class="btn" onclick="nextQuestion()">Next</button>
        <button id="submitBtn" class="btn btn-success" onclick="submitAssessment()" style="display:none;">Submit Assessment</button>
    </div>

    <div id="result-section" class="card" style="display:none;"></div>

    <script>
        const questions = [
            // Basic + Medium + Multi-option questions (as earlier)
            { type: "single", question: "1. Correct file extension for C programs?", options: [".cpp", ".c", ".java", ".py"], answer: ".c" },
            { type: "single", question: "2. Operator for remainder?", options: ["*", "/", "%", "&"], answer: "%" },
            { type: "single", question: "3. Default return type of main()?", options: ["void", "int", "char", "float"], answer: "int" },

            // --- Advanced 10 long code output questions ---
            { type: "single", question: "4. What is the output of this code?", code:
`#include<stdio.h>
int main() {
    int arr[5] = {2, 4, 6, 8, 10};
    int sum = 0;
    for(int i = 0; i < 5; i++) {
        sum += arr[i];
    }
    printf("%d", sum);
    return 0;
}`, options: ["30", "25", "28", "Error"], answer: "30" },

            { type: "single", question: "5. Output of this code?", code:
`#include<stdio.h>
int main() {
    int a = 10;
    int b = 20;
    a = a ^ b;
    b = a ^ b;
    a = a ^ b;
    printf("%d %d", a, b);
    return 0;
}`, options: ["10 20", "20 10", "30 0", "0 30"], answer: "20 10" },

            { type: "single", question: "6. Output of this recursive factorial code?", code:
`#include<stdio.h>
int fact(int n) {
    if(n==0) return 1;
    return n * fact(n-1);
}
int main() {
    printf("%d", fact(4));
    return 0;
}`, options: ["16", "12", "24", "20"], answer: "24" },

            { type: "single", question: "7. Output of this bubble sort pass?", code:
`#include<stdio.h>
int main() {
    int arr[3] = {3, 1, 2};
    for(int i=0;i<2;i++) {
        if(arr[i] > arr[i+1]) {
            int t = arr[i];
            arr[i] = arr[i+1];
            arr[i+1] = t;
        }
    }
    printf("%d %d %d", arr[0], arr[1], arr[2]);
    return 0;
}`, options: ["1 2 3", "2 1 3", "3 2 1", "1 3 2"], answer: "1 3 2" },

            { type: "single", question: "8. Output after binary search mid element print?", code:
`#include<stdio.h>
int main() {
    int arr[5] = {1, 3, 5, 7, 9};
    int low=0, high=4, mid;
    mid = (low + high) / 2;
    printf("%d", arr[mid]);
    return 0;
}`, options: ["1", "3", "5", "7"], answer: "5" },

            { type: "single", question: "9. Output of pointer function?", code:
`#include<stdio.h>
void show(int *p) {
    printf("%d", *p);
}
int main() {
    int x = 15;
    show(&x);
    return 0;
}`, options: ["15", "x", "Address", "Error"], answer: "15" },

            { type: "single", question: "10. Output after writing to file and reading?", code:
`#include<stdio.h>
int main() {
    FILE *fp = fopen("data.txt","w");
    fprintf(fp, "Hello");
    fclose(fp);
    fp = fopen("data.txt","r");
    char ch;
    while((ch = fgetc(fp)) != EOF) {
        printf("%c", ch);
    }
    fclose(fp);
    return 0;
}`, options: ["Hello", "Error", "Nothing", "data.txt"], answer: "Hello" },

            { type: "single", question: "11. Output of recursive sum function?", code:
`#include<stdio.h>
int sum(int n) {
    if(n==0) return 0;
    return n + sum(n-1);
}
int main() {
    printf("%d", sum(5));
    return 0;
}`, options: ["10", "15", "20", "5"], answer: "15" },

            { type: "single", question: "12. What will printf print in this function?", code:
`#include<stdio.h>
void calc(int a, int b) {
    printf("%d", a*b + b);
}
int main() {
    calc(4,3);
    return 0;
}`, options: ["15", "12", "20", "24"], answer: "15" },

            { type: "single", question: "13. Output of loop operation?", code:
`#include<stdio.h>
int main() {
    int i;
    for(i=1;i<=3;i++) {
        printf("%d", i*i);
    }
    return 0;
}`, options: ["149", "123", "14916", "1234"], answer: "149" }
        ];

        let currentQuestion = 0;
        let answers = {};
        let timeLeft = 60;
        let timer;

function checkDailyAttempt() {
    const today = new Date().toISOString().slice(0,10);
    const lastAttempt = localStorage.getItem('lastAttempt');
    if (lastAttempt === today) {
        document.body.innerHTML = `
            <h2>You can attempt the assessment only once per day.</h2>
            <button style="padding:10px 20px; font-size:16px; margin-top:20px;background-color: #001f3f; color:#FFFFFF" onclick="window.location.href='../index.html'">
                Home Page
            </button>
            <button style="padding:10px 20px; font-size:16px; margin-top:20px;background-color: #001f3f; color:#FFFFFF" onclick="window.location.href='../course.html'">
                More Course
            </button>
        `;
        return true;
    }
    return false;
}

        if (checkDailyAttempt()) throw new Error("Attempt already made today.");

        function loadQuestion() {
            clearInterval(timer);
            timeLeft = 60;
            const q = questions[currentQuestion];
            document.getElementById('timer').textContent = `Time left: ${timeLeft} seconds`;
            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = `Time left: ${timeLeft} seconds`;
                if (timeLeft <= 0) nextQuestion();
            }, 1000);

            const container = document.getElementById('quiz-container');
            container.innerHTML = `<div class="question">${q.question}</div>`;

            if (q.code) {
                container.innerHTML += `<textarea readonly>${q.code}</textarea>`;
            }

            q.options.forEach(opt => {
                const checked = (answers[currentQuestion] === opt) ? "checked" : "";
                container.innerHTML += `<label><input type="radio" name="opt" value="${opt}" ${checked} onchange="answers[currentQuestion]=this.value;"> ${opt}</label><br>`;
            });

            document.getElementById('submitBtn').style.display = (currentQuestion === questions.length -1) ? 'inline-block' : 'none';
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                loadQuestion();
            }
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                loadQuestion();
            }
        }

        function submitAssessment() {
            clearInterval(timer);
            localStorage.setItem('lastAttempt', new Date().toISOString().slice(0,10));
            let score = 0;
            questions.forEach((q, idx) => {
                if (answers[idx] && answers[idx] === q.answer) score++;
            });

            const percentage = (score / questions.length) * 100;
            let html = `<h2>Score: ${score} / ${questions.length} (${percentage.toFixed(2)}%)</h2>`;

            if (percentage >= 70) {
                  html += `<p><strong>Congratulations! You passed.</strong></p>
                  <button class="btn btn-success" onclick="window.location.href='certificatec.html'">Generate Certificate</button>`;
            } else {
                  html += `<p><strong>Failed. You can retake the test tomorrow.</strong></p>`;
            }
            const result = document.getElementById('result-section');
            result.innerHTML = html;
            result.style.display = "block";

            document.getElementById('quiz-container').style.display = "none";
            document.getElementById('timer').style.display = "none";
            document.getElementById('submitBtn').style.display = "none";
        }

        function generateCertificate() {
            const name = document.getElementById('username').value || "Student";
            const win = window.open('', '', 'width=800,height=600');
            win.document.write(`<h1>Certificate of Completion</h1>
                                <p>This certifies that <strong>${name}</strong> has successfully completed the C Programming Assessment.</p>
                                <p>Date: ${new Date().toLocaleDateString()}</p>
                                <button onclick="window.print()">Print Certificate</button>`);
        }
        loadQuestion();
    </script>

</body>
</html>
